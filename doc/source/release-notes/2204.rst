=================================
22.04 (Draft version in progress)
=================================

The 22.04 OpenStack Charms release includes updates for the charms described on
the :doc:`../project/openstack-charms` page. As of this release, the project
consists of 62 (...CHANGE IF REQUIRED...) stable charms.

For the list of bugs resolved in this release refer to the `22.04 milestone`_
in Launchpad.

For scheduling information of past and future releases see the
:doc:`../project/release-schedule`.

.. note::

   Release Notes contents is superseded by updated information published in the
   `OpenStack Charm Guide`_ (this guide) after the release of any given
   OpenStack Charms version.

.. important::

   Always upgrade to the latest stable charms before making any major changes
   to your cloud and before filing bug reports. Note that charm upgrades and
   OpenStack upgrades are functionally different. For instructions on
   performing the different upgrade types see `Upgrades overview`_ in the
   `OpenStack Charms Deployment Guide`_.

.. contents:: Summary of changes:
   :local:
   :depth: 2
   :backlinks: top

New stable charms
-----------------

<TITLE>
~~~~~~~

New stable charm features
-------------------------

With each new feature, there is a corresponding example bundle in the form of a
test bundle, and/or a section in the `OpenStack Charms Deployment Guide`_, that
details its usage. Test bundles are located in the ``src/tests/bundles``
directory of the relevant charm repository (see all `charm repositories`_).

cinder charm: new option to configure ``scheduler_default_filters``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The cinder charm has a new configuration option: ``scheduler-default-filters``.
This option can be used to set the value of ``scheduler_default_filters``
in the cinder configuration.

glance charm: add support for Cinder iSCSI/FC backend storage
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The glance charm adds support for Cinder iSCSI/FC backend storage through three
new configuration options:

* ``cinder-volume-types``

Comma separated list of cinder volume_types that can be configured as cinder
storage backends. The first one in the list will be configured as the default
backend.

* ``cinder-http-retries``

Number of cinderclient retries on failed http calls.

* ``cinder-state-transition-timeout``

Time period of time in seconds to wait for a cinder volume transition to
complete.

ironic-conductor charm: new option to configure use-ipmitool-retries
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ironic-conductor charm has a new configuration option:
``use-ipmitool-retries``. This option can be used to set the value of
``use_ipmitool_retries`` in the ironic configuration.

keystone charm: add get-admin-password action
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The keystone charm has a new ``get-admin-password`` action. This action
retrieves the admin password of keystone service via juju action.

ceph-mon charm: add list-crush-rules action
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ceph-mon charm has a new ``list-crush-rules`` action, which provides a list
of CRUSH rules defined in Ceph clusters.

The action has a ``format`` parameter that accepts the following values:

* 'json' - provides detailed information in json format
* 'yaml' - provides detailed information in yaml format
* 'text' - provides less information in human readable format [default]


nova-cloud-controller charm: new option to configure ``scheduler-max-attempts``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-cloud-controller charm has a new configuration option:
``scheduler-max-attempts``. This option will set the scheduler.max_attempts
in the nova configuration.

This flag allows to increase the number of retries and hence hosts to schedule
on and therefore allowing the successful scheduling of instances.

nova-compute charm: new option to add extra-repositories
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute charm has a new configuration option for adding extra apt
repositories to the compute node: ``extra-repositories``. This configuration
option takes a comma-delimited list of apt source repository spec entries
to add as apt package repositories. The valid values are those accepted by the
add-apt-repository command.

nova-compute charm: vTPM Enablement
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute charm now allows for installing and configuring for virtual
TPM (vTPM) support. The nova-compute charm has a new option ``enable-vtpm``
that when set to True, will configure the nova and libvirt services to be able
to provide vTPM devices via swtpm.

This requires swtpm, swtpm-tools, and libtpm0 packages to be available for
installation. These are available in the Ubuntu 22.04 release and are expected
to be backported to Ubuntu 20.04. The OpenStack Charmers team has included a
backport of these packages in the ppa:openstack-charmers/swtpm ppa.

neutron-api charm has a new configuration option: ``uplink-status-propagation``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

This option allows the PF (physical function) link status for an OpenStack
SR-IOV port on the host to be propagated to the VF (virtual function) link
status on a cloud instance. To enable this, set the option to 'true' and assign
attribute 'propagate_uplink_status' to the SR-IOV port during its creation
(via the flag ``--enable-uplink-status-propagation``).

Increase KeepAlive timeout for OpenStack API endpoints and dashboard
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The HTTP KeepAlive timeout for OpenStack API endpoints and the Dashboard
has been changed to 75 seconds. The previous timeout of 5 seconds
(Apache's default) was causing unnecessary termination of client TCP
connections, which was also affecting inter-service (OpenStack)
communication.

neutron-api charm: new option to enable network-segment-range support
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The neutron-api charm has a new option for enabling Neutron's 'Network
Segment Range' service plugin: ``enable-network-segment-range``. It
allows cloud operators to dynamically manage network segment ranges
through the Neutron API. For more details, refer to `Network segment
ranges`_ in the upstream documentation.

nova-compute charm: new options to set block device timeout
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute charm has two new options:

* ``block-device-allocate-retries``
* ``block-device-allocate-retries-interval``

These options configure the block device allocation timeout. The default
values have been set at 300 and 3 respectively, resulting in an overall
timeout of 15 minutes. The previous (inherited upstream) timeout of 3
minutes resulted in failures when dealing with large guest images (e.g.
Windows or customised Linux).

nova-cloud-controller charm: new option to expose max_local_block_devices
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-cloud-controller charm has a new option:
``max-local-block-devices``. It exposes the upstream
max_local_block_devices flag. In particular, setting it to '0' will
forbid local block devices, effectively compelling users to request
volumes instead. For more information, refer to `block device mapping
FAQ section`_ in the upstream documentation.

nova-cloud-controller charm: new options to filter hosts by isolating aggregates
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-cloud-controller charm has three new options:

* ``limit-tenants-to-placement-aggregate``
* ``placement-aggregate-required-for-tenants``
* ``enable-isolated-aggregate-filtering``

These options are useful for limiting host aggregates to specific
tenants. For more information, refer to `Filtering hosts by isolating
aggregates`_ in the upstream documentation.

nova-compute charm: new option to expose reserved_host_disk_mb
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute charm has a new option: ``reserved-host-disk``. It
takes into account available host disk space when scheduling instances.
It is similar to existing options ``reserved-host-memory`` and
``reserved-huge-pages``.

openstack-dashboard charm: new options to allow for branding
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The openstack-dashboard charm has three new options:

* ``site-branding``
* ``site-branding-link``
* ``help-url``

These options are used to set Dashboard parameters that reflect the
local environment.

Documentation updates
---------------------

<TITLE>
~~~~~~~

New tech-preview charms
-----------------------

cinder-nimblestorage
~~~~~~~~~~~~~~~~~~~~~~~~

The cinder-nimblestorage charm provides NimbleStorage storage backend support
for the Openstack Cinder service. It is a subordinate charm used in conjunction
with the cinder principal charm.

cinder-solidfire
~~~~~~~~~~~~~~~~~~~~~~~~

The cinder-solidfire charm provides Solidfire storage backend support for
the Openstack Cinder service. It is a subordinate charm used in conjunction
with the cinder principal charm.

nova-compute-nvidia-vgpu
~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute-nvidia-vgpu charm provides Nvidia vGPU support to the
OpenStack Nova Compute service. It is a subordinate charm used in conjunction
with the nova-compute principal charm.

New tech-preview charm features
-------------------------------

<TITLE>
~~~~~~~

Informational notices
---------------------

nova-cloud-controller: cpu-allocation-ratio default changed to 2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The default value for cpu-allocation-ratio has been reduced from 16
to 2.  The old default was more appropriate for dev, test or lab type
environments but is rarely suitable for clouds running production
workloads.  If you were relying on the previous default of 16 and
start to see VM scheduling failures after upgrade of this charm, you
can opt back into a higher contention ratio by running:

``juju config nova-cloud-controller cpu-allocation-ratio=16``

Deprecation notices
-------------------

<TITLE>
~~~~~~~

Removed features
----------------

<TITLE>
~~~~~~~

Removed charms
--------------

<TITLE>
~~~~~~~

Issues discovered during this release cycle
-------------------------------------------

<TITLE>
~~~~~~~

.. LINKS
.. _22.04 milestone: https://launchpad.net/openstack-charms/+milestone/22.04
.. _OpenStack Charms Deployment Guide: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest
.. _OpenStack Charm Guide: https://docs.openstack.org/charm-guide/latest/
.. _Upgrades overview: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest/upgrade-overview.html
.. _charm repositories: https://opendev.org/openstack?sort=alphabetically&q=charm-&tab=
.. _Network segment ranges: https://docs.openstack.org/neutron/latest/admin/config-network-segment-ranges.html
.. _block device mapping FAQ section: https://docs.openstack.org/nova/latest/user/block-device-mapping.html#faqs
.. _Filtering hosts by isolating aggregates: https://docs.openstack.org/nova/latest/reference/isolate-aggregates.html

.. COMMITS

.. BUGS
