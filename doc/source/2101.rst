.. _release_notes_21.01:

=================================
21.01 (Draft version in progress)
=================================

Summary
-------

The 21.01 OpenStack Charms project release includes updates for the charms
described on the `Charms`_ page. As of this release, the project consists of 60
supported (stable) charms.

For the list of bugs resolved in this release refer to the `21.01 milestone`_
in Launchpad.

For scheduling information of past and future releases see the `Release
schedule`_.

General charm information is published in the `OpenStack Charm Guide`_ (this
guide) which ultimately supersedes Release Notes contents.

.. important::

   Always upgrade to the latest stable charms before making any major changes
   to your cloud and before filing bug reports. Refer to section `Upgrading
   charms`_ below for details.

New charm features
------------------

With each new feature, there is a corresponding example bundle in the form of a
test bundle, and/or a section in the `OpenStack Charms Deployment Guide`_, that
details its usage. Test bundles are located in the ``src/tests/bundles``
directory of the relevant charm repository.

Cinder-Ceph - Image mirroring
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The cinder-ceph charm now supports image replication to a second Ceph cluster.
This is achieved by connecting its new relation ``ceph-replication-device`` to
the second Ceph cluster and setting its new ``rbd-mirroring-mode``
configuration option to `image`.

Whether a particular Cinder Ceph image is replicated or not is determined by
its `Cinder volume type`_.

For implementation details see the `Cinder-Ceph replication development
notes`_.

Trilio Charms
~~~~~~~~~~~~~

Trilio charms will no longer be released with the same cadence as the other
OpenStack charms. Instead, they will be released shortly after releases of the
Trilio code. Trilio 4.1 release is due in Febuary and the Trilio charms will be
released shortly thereafter.

New charms
----------

Preview charm features
----------------------

n/a

Deprecation notices
-------------------

OpenStack on LXD documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The OpenStack on LXD documentation was moved from the OpenStack Charm Guide to
the `openstack-on-lxd`_ repository. Users wishing to use an all-in-one
OpenStack solution should explore the `MicroStack`_ project.

Removed features
----------------

Removed charms
--------------

n/a

Known issues
------------

Barbican DB migration
~~~~~~~~~~~~~~~~~~~~~

With Focal Ussuri, running command ``barbican-manage db upgrade`` against a
barbican application that is backed by a MySQL InnoDB Cluster will lead to a
failure (see bug `LP #1899104`_). This was discovered while resolving bug `LP
#1827690`_.

Both the charm bug `LP #1827690`_ and the package bug `LP #1899104`_ are known
issues that will be addressed shortly after the 20.10 release.

The package bug only affects Focal Ussuri and is not present in Victoria, nor
is it present when using (Bionic) Percona Cluster as the back-end DB.

Designate and Vault at Ocata and earlier
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The designate charm for OpenStack Ocata (and earlier) does not yet support SSL
via Vault and the certificates relation. See bug `LP #1839019`_. The charm
works as intended in this scenario starting with OpenStack Pike.

OpenStack os-brick, Ceph Octopus, and Focal
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The Ceph RBD Mirror and Cinder Backup Swift Proxy charms do not work with Ceph
Octopus due to an issue with the upstream OpenStack os-brick library (see
bug `LP #1865754`_). As Octopus is the default Ceph version on Ubuntu 20.04 LTS
(Focal) these charms cannot be used on Focal until the issue is resolved. Here
are the resulting charm-specific behaviours:

* ceph-rbd-mirror charm: The charm will enter a blocked state after configuring
  pool mirroring (see bug `LP #1879749`_).
* cinder-backup-swift-proxy charm: If a backup volume operation is performed
  the resulting volume will be in error (see bug `LP #1890821`_).

Series upgrade - percona-cluster and vault charms
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

percona-cluster
^^^^^^^^^^^^^^^

During a series upgrade from Xenial (16.04) to Bionic (18.04) the
percona-cluster charm may fail during the ``post-series-upgrade`` hook. This
appears to be because the percona-cluster charm may erroneously delete the file
``/var/lib/percona-xtradb-cluster/seeded`` (see bug `LP #1868326`_). If this
occurs, then executing the following commands on the failed unit will recover
the hook and allow it to complete the series upgrade:

.. code-block:: none

   juju run percona-cluster/N 'echo "done" > /var/lib/percona-xtradb-cluster/seeded'
   juju resolved percona-cluster/N

This may be required for each percona-cluster unit.

vault
^^^^^

If a series upgrade is attempted while Vault is sealed then manual intervention
will be required (see bugs `LP #1886083`_ and `LP #1890106`_). The vault leader
unit (which will be in error) will need to be unsealed and the hook error
resolved. The `Vault section`_ in the `OpenStack Charms Deployment Guide`_ has
detailed unsealing instructions and the hook error can be resolved with:

.. code-block:: none

   juju resolved vault/N

Upgrading charms
----------------

Always use the latest stable charm revision before proceeding with topological
changes, application migrations, workload upgrades, series upgrades, or
bug report filing.

Please ensure that the keystone charm is upgraded first.

To upgrade an existing deployment to the latest charm version simply use the
:command:`upgrade-charm` command. For example:

.. code-block:: none

   juju upgrade-charm keystone

Charm upgrades and OpenStack upgrades are functionally different. Charm
upgrades ensure that the deployment has the latest charm revision, containing
the latest charm fixes and features, whereas OpenStack upgrades influence the
software package versions of OpenStack itself.

A charm upgrade does not trigger an OpenStack upgrade. An OpenStack upgrade is
a separate process. However, an OpenStack upgrade does require the latest charm
revision. Please refer to `OpenStack upgrades`_ in the `OpenStack Charms
Deployment Guide`_ for more details.

.. LINKS
.. _Charms: openstack-charms.html
.. _21.01 milestone: https://launchpad.net/openstack-charms/+milestone/21.01
.. _OpenStack Charms Deployment Guide: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest
.. _OpenStack Charm Guide: https://docs.openstack.org/charm-guide/latest/
.. _Release schedule: release-schedule.html
.. _OpenStack upgrades: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest/app-upgrade-openstack.html
.. _Vault section: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest/app-vault.html
.. _Cinder volume type: https://docs.openstack.org/cinder/latest/contributor/replication.html#volume-types-extra-specs
.. _Cinder-Ceph replication development notes: https://github.com/ionutbalutoiu/cinder-ceph-replication
.. _MicroStack: https://microstack.run
.. _openstack-on-lxd: https://github.com/openstack-charmers/openstack-on-lxd

.. COMMITS

.. BUGS
.. _LP #1839019: https://bugs.launchpad.net/charm-designate/+bug/1839019
.. _LP #1877594: https://bugs.launchpad.net/charm-neutron-gateway/+bug/1877594
.. _LP #1876730: https://bugs.launchpad.net/netplan/+bug/1876730
.. _LP #1890628: https://bugs.launchpad.net/charm-neutron-api-plugin-arista/+bug/1890628
.. _LP #1868326: https://bugs.launchpad.net/charm-percona-cluster/+bug/1868326
.. _LP #1890106: https://bugs.launchpad.net/vault-charm/+bug/1890106
.. _LP #1886083: https://bugs.launchpad.net/vault-charm/+bug/1886083
.. _LP #1888389: https://bugs.launchpad.net/charm-trilio-data-mover/+bug/1888389
.. _LP #1865754: https://bugs.launchpad.net/tripleo/+bug/1865754
.. _LP #1890821: https://bugs.launchpad.net/charm-cinder-backup-swift-proxy/+bug/1890821
.. _LP #1879749: https://bugs.launchpad.net/charm-ceph-rbd-mirror/+bug/1879749
.. _LP #1884548: https://bugs.launchpad.net/charm-cinder/+bug/1884548
.. _LP #1856106: https://bugs.launchpad.net/charm-ceph-radosgw/+bug/1856106
.. _LP #1827690: https://bugs.launchpad.net/charm-barbican/+bug/1827690
.. _LP #1899104: https://bugs.launchpad.net/ubuntu/+source/barbican/+bug/1899104
