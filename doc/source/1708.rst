.. _release_notes_17.08

=====
17.08
=====

Summary
=======

The 17.08 OpenStack Charm release includes updates for the following charms:

* aodh
* barbican
* ceilometer
* ceilometer-agent
* ceph
* ceph-fs
* ceph-mon
* ceph-osd
* ceph-radosgw
* cinder
* cinder-backup
* cinder-ceph
* designate
* designate-bind
* glance
* gnocchi
* hacluster
* heat
* keystone
* keystone-ldap
* lxd
* manila
* manila-generic
* neutron-api
* neutron-api-odl
* neutron-openvswitch
* neutron-gateway
* nova-cloud-controller
* nova-compute
* odl-controller
* openstack-dashboard
* openvswitch-odl
* percona-cluster
* rabbitmq-server
* swift-proxy
* swift-storage

New Charm Features
==================

OpenStack Pike support on 16.04
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The charms provide full support for OpenStack Pike. For further details and
documentation on Openstack Pike please check out
http://releases.openstack.org/pike

To deploy OpenStack Pike on Ubuntu 16.04, use the 'openstack-origin'
configuration option, for example:


.. code:: bash

    cat > config.yaml << EOF
    nova-cloud-controller:
      openstack-origin: cloud:xenial-pike
    EOF

    juju deploy --config config.yaml nova-cloud-controller

To upgrade an existing Ocata based deployment on Ubuntu 16.04 to the Newton
release, re-configure the charm with a new openstack-origin
configuration:

.. code:: bash

    juju config nova-cloud-controller openstack-origin=cloud:xenial-pike

Please ensure that ceph services are upgraded before services that consume ceph
resources, such as cinder, glance and nova-compute:

.. code:: bash

    juju config ceph-mon source=cloud:xenial-pike
    juju config ceph-osd source=cloud:xenial-pike

.. note::

   Upgrading an OpenStack cloud is still not without risk; upgrades should
   be tested in pre-production testing environments prior to production deployment
   upgrades.

Gnocchi Support
~~~~~~~~~~~~~~~

The OpenStack charms now support deployment of Gnocchi for storage of resources,
metrics and associated measures generated by Ceilometer from across an
OpenStack Cloud.

This preview release provides support for use with Ceph for measure storage,
with MySQL providing the supporting database infrastructure.  The first GA
release of the Gnocchi charm will be made independently of the next charm
release in October.

To deploy the preview version of the Gnocchi charm:

.. code:: bash

    juju deploy cs:~openstack-charmers-next/gnocchi
    juju deploy cs:memcached
    juju add-relation gnocchi ceph-mon
    juju add-relation gnocchi ceilometer
    juju add-relation gnocchi mysql
    juju add-relation gnocchi keystone
    juju add-relation gnocchi memcached

.. note::

   The Ceilometer API will be automatically disabled as soon as Ceilometer
   is configured to store cloud telemetry data in Gnocchi.

.. note::

   The Gnocchi charm only supports deployment of Gnocchi with
   OpenStack Ocata or later.

Neutron Internal DNS
~~~~~~~~~~~~~~~~~~~~

The Neutron charms now support use of the Neutron ML2 DNS extension driver,
supporting management of DNS records for instances internally to Neutron.

To enable this feature please review the 'enable-ml2-dns' and 'dns-domain'
options of the neutron-api charm, and the 'dns-servers' option of the
neutron-gateway and neutron-openvswitch charms.

Improved application configuration in LXD deployments
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Deployment of charms providing API services in LXD containers now calculates
worker processes more intelligently, capping at 4 worker processes unless
an explicit value is provided via the 'worker-multiplier' option.  This
limits default memory consumption in converged architectures where API
services may be placed in densely packed LXD containers on high specification
hardware.

The percona-cluster charm also now limit the InnoDB buffer pool size to
a maximum of 512MB (or 50% of system memory on smaller deployments) unless
explicit configuration is provided to the charm.

Percona Cluster password management
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Previous versions of the percona-cluster charm required that the SST and
root passwords be provided via configuration options set prior to deployment.

If the 'root-password' and 'sst-password' options are not provided, the
charm will now generate passwords automatically across a clustered
multi-unit deployment.

Percona Cluster tuning
~~~~~~~~~~~~~~~~~~~~~~

The percona-cluster charm now provides a high-level 'tuning-level' option,
supporting three configuration levels:

 safest (default): use configuration options with best data
                   integrity guarantees.
 fast:             compromise some data integrity guarantees
                   to improve performance.
 unsafe:           pretty much throw away all data integrity
                   guarantees to maximise performance.

Use of the 'fast' option may be appropriate in multi-unit deployments where
some level of consistency can be sacrificed at the individual unit level
due to the clustered nature of the deployment.

DVR + Layer 3 HA
~~~~~~~~~~~~~~~~

The neutron-api charm now supports enabling DVR and Layer 3 HA at the same
time for OpenStack Newton clouds or later.

Ceph Bluestore support
~~~~~~~~~~~~~~~~~~~~~~

The Ceph charms now support the latest Luminous stable release, including
the new Bluestore storage backend for OSD devices.  This is not currently
the default for charm based Ceph deployments; Bluestore may become the
default in a later charm release pending further performance and resilience
testing.

To enable use of Bluestore for OSD devices:

.. code:: bash

    juju config ceph-osd bluestore=true

Upgrading charms
================

Please ensure that the keystone charm is upgraded first.

To upgrade an existing deployment to the latest charm version simply use the
'upgrade-charm' command:

.. code:: bash

    juju upgrade-charm cinder

Deprecation Notices
===================

ZeroMQ messaging support across the charms will be removed during the Queens
development cycle.

PostgreSQL database support across the charms will be removed during the
Queens developement cycle.

Deploy from Source (DFS) support is under review for sustainability and may be
removed during the Queens development cycle.

Known Issues
============

hacluster scale-out
~~~~~~~~~~~~~~~~~~~

By default, the hacluster charm will assume a cluster size of three units; in
order to scale a three unit clustered application out, you must increase the
cluster-count configuration option to the target size prior to adding the
additional units to the clustered application.

https://bugs.launchpad.net/charm-hacluster/+bug/1424048

Liberty to Mitaka upgrades
~~~~~~~~~~~~~~~~~~~~~~~~~~

When upgrading Trusty/Liberty clouds to Trusty/Mitaka using the configuration
option 'big bang' approach to upgrading, the neutron-gateway charm incorrectly
configures the neutron-openvswitch-agent due to a configuration file name
change. This can be resolved post upgrade completion by triggering execution
of the config-changed hook by toggling debug logging on and off.

https://bugs.launchpad.net/charm-neutron-gateway/+bug/1634923

.. note::

   This problem does not occur when action managed upgrades are used to
   upgrade the neutron-gateway application.


heat encryption keys
~~~~~~~~~~~~~~~~~~~~

In HA deployments individual units of the heat application are configured
with different encryption keys resulting in issues when authentication
information is stored by units in the database. This bug will be fixed in
a stable charm update after the 17.08 release.

https://bugs.launchpad.net/charm-heat/+bug/1714157

Nova LXD Ceph support
~~~~~~~~~~~~~~~~~~~~~

Support for presentation of Ceph backed Cinder volumes to Nova LXD
instances is supported in the Pike OpenStack release.  This integration
uses the Linux kernel RBD module and requires a minimum of a
Linux 4.5 to support the default crush tunables for Luminous.

Deployments using the release Xenial kernel (4.4) should set the crush
tunables level to 'hammer':

.. code:: bash

   juju run --unit ceph-mon/0 'sudo ceph osd crush tunables hammer'

Xenial deployments using hardware enablement kernels (hwe) or
deployments on later Ubuntu releases do not require this workaround.

https://bugs.launchpad.net/charm-ceph/+bug/1716735

Bugs Fixed
==========

For the full list of bugs resolved for the 17.08 release please refer to
https://launchpad.net/openstack-charms/+milestone/17.08
