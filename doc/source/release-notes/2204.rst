=================================
22.04 (Draft version in progress)
=================================

The 22.04 OpenStack Charms release includes updates for the charms described on
the :doc:`../project/openstack-charms` page. As of this release, the project
consists of 62 (...CHANGE IF REQUIRED...) stable charms.

For the list of bugs resolved in this release refer to the `22.04 milestone`_
in Launchpad.

For scheduling information of past and future releases see the
:doc:`../project/release-schedule`.

.. note::

   Release Notes contents is superseded by updated information published in the
   `OpenStack Charm Guide`_ (this guide) after the release of any given
   OpenStack Charms version.

.. important::

   Always upgrade to the latest stable charms before making any major changes
   to your cloud and before filing bug reports. Note that charm upgrades and
   OpenStack upgrades are functionally different. For instructions on
   performing the different upgrade types see `Upgrades overview`_ in the
   `OpenStack Charms Deployment Guide`_.

.. contents:: Summary of changes:
   :local:
   :depth: 2
   :backlinks: top

New stable charms
-----------------

<TITLE>
~~~~~~~

New stable charm features
-------------------------

With each new feature, there is a corresponding example bundle in the form of a
test bundle, and/or a section in the `OpenStack Charms Deployment Guide`_, that
details its usage. Test bundles are located in the ``src/tests/bundles``
directory of the relevant charm repository (see all `charm repositories`_).

cinder charm: new option to configure ``scheduler_default_filters``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The cinder charm has a new configuration option: ``scheduler-default-filters``.
This option can be used to set the value of ``scheduler_default_filters``
in the cinder configuration.

glance charm: add support for Cinder iSCSI/FC backend storage
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The glance charm adds support for Cinder iSCSI/FC backend storage through three
new configuration options:

* ``cinder-volume-types``

Comma separated list of cinder volume_types that can be configured as cinder
storage backends. The first one in the list will be configured as the default
backend.

* ``cinder-http-retries``

Number of cinderclient retries on failed http calls.

* ``cinder-state-transition-timeout``

Time period of time in seconds to wait for a cinder volume transition to
complete.

ironic-conductor charm: new option to configure use-ipmitool-retries
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The ironic-conductor charm has a new configuration option:
``use-ipmitool-retries``. This option can be used to set the value of
``use_ipmitool_retries`` in the ironic configuration.

keystone charm: add get-admin-password action
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The keystone charm has a new ``get-admin-password`` action. This action
retrieves the admin password of keystone service via juju action. 

nova-cloud-controller charm: new option to configure ``scheduler-max-attempts``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-cloud-controller charm has a new configuration option:
``scheduler-max-attempts``. This option will set the scheduler.max_attempts
in the nova configuration.

This flag allows to increase the number of retries and hence hosts to schedule
on and therefore allowing the successful scheduling of instances.

nova-compute charm: new option to add extra-repositories
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute charm has a new configuration option for adding extra apt
repositories to the compute node: ``extra-repositories``. This configuration
option takes a comma-delimited list of apt source repository spec entries
to add as apt package repositories. The valid values are those accepted by the
add-apt-repository command.

nova-compute charm: vTPM Enablement
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute charm now allows for installing and configuring for virtual
TPM (vTPM) support. The nova-compute charm has a new option ``enable-vtpm``
that when set to True, will configure the nova and libvirt services to be able
to provide vTPM devices via swtpm.

This requires swtpm, swtpm-tools, and libtpm0 packages to be available for
installation. These are available in the Ubuntu 22.04 release and are expected
to be backported to Ubuntu 20.04. The OpenStack Charmers team has included a
backport of these packages in the ppa:openstack-charmers/swtpm ppa.

<TITLE>
~~~~~~~

Documentation updates
---------------------

<TITLE>
~~~~~~~

New tech-preview charms
-----------------------

nova-compute-nvidia-vgpu
~~~~~~~~~~~~~~~~~~~~~~~~

The nova-compute-nvidia-vgpu charm provides Nvidia vGPU support to the
OpenStack Nova Compute service. It is a subordinate charm used in conjunction
with the nova-compute principal charm.

New tech-preview charm features
-------------------------------

<TITLE>
~~~~~~~

Informational notices
---------------------

nova-cloud-controller: cpu-allocation-ratio default changed to 2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The default value for cpu-allocation-ratio has been reduced from 16
to 2.  The old default was more appropriate for dev, test or lab type
environments but is rarely suitable for clouds running production
workloads.  If you were relying on the previous default of 16 and
start to see VM scheduling failures after upgrade of this charm, you
can opt back into a higher contention ratio by running:

``juju config nova-cloud-controller cpu-allocation-ratio=16``

Deprecation notices
-------------------

<TITLE>
~~~~~~~

Removed features
----------------

<TITLE>
~~~~~~~

Removed charms
--------------

<TITLE>
~~~~~~~

Issues discovered during this release cycle
-------------------------------------------

<TITLE>
~~~~~~~

.. LINKS
.. _22.04 milestone: https://launchpad.net/openstack-charms/+milestone/22.04
.. _OpenStack Charms Deployment Guide: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest
.. _OpenStack Charm Guide: https://docs.openstack.org/charm-guide/latest/
.. _Upgrades overview: https://docs.openstack.org/project-deploy-guide/charm-deployment-guide/latest/upgrade-overview.html
.. _charm repositories: https://opendev.org/openstack?sort=alphabetically&q=charm-&tab=

.. COMMITS

.. BUGS
